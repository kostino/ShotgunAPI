{% extends 'base.html' %}
{% block title %}My Ride Applications{% endblock %}

{% block style %}{% endblock %}

{% block content %}
    <div class="container-md px-4 py-3 my-3" style="background-color: white; border-radius: 15px">

        <!-- Title row -->
        <div class="row pb-1">
            <div class="col-md">
                <h3 class="mx-auto">
                    My Ride Applications
                </h3>
            </div>
        </div>

        <hr>

        <!-- No applications message -->
        {% if not events %}
            <div class="container">
                <h4>You currently have no active ride applications. Browse interesting events to go to at the events page.</h4>
            </div>
        {% endif %}

        <!-- Events/Rides Accordion -->
        <div class="accordion" id="accordion">

            {% for event_id, event in events.items() %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-heading{{ event_id }}">
                        <button class="accordion-button {% if loop.index0 != 0 %}collapsed{% endif %}"
                                type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse{{ event_id }}"
                                aria-expanded="false" aria-controls="flush-collapseOne">
                            <h4>{{ event['title'] }}</h4>
                            <a href="{{ url_for("EventRides", event_id=event_id, _external=True) }}"
                               style="text-decoration: none" >
                                <span class="align-text-top mx-2">- View Event</span>
                            </a>
                        </button>


                    </h2>

                    <div id="flush-collapse{{ event_id }}"
                         class="accordion-collapse collapse {% if loop.index0 == 0 %}show{% endif %}"
                         aria-labelledby="flush-heading{{ event_id }}" data-bs-parent="#accordion">

                        {% for application in event['applications'] %}

                            <!-- Application -->
                            <div class="row align-items-center my-3 mx-1"
                                 style="border-style: solid; border-radius: 16px; border-width: thin; border-color: darkgray;">
                                <div class="col-md-4 px-0">
                                    <a href="{{ url_for("UserProfile", username=application['ride_driver'], _external=True) }}">
                                        <!-- TODO: Swap this out with the vehicle picture -->
                                        <img src="{{ url_for('ProfilePicture', filename=application['driver_picture'], _external=True) }}"
                                             alt="{{ application['ride_driver'] }}'s profile picture"
                                             style="width: 100%; height:100%; max-height: 200px; object-fit: cover; border-radius: 15px;">
                                    </a>
                                </div>
                                <div class="col-md-6 ms-4">
                                    <div class="row">
                                        <div class="container my-2">
                                            <a href="{{ url_for("RideView", ride_id=application['ride_id'], _external=True) }}"
                                               style="text-decoration: none">
                                                <h3>{{ application['driver_first_name'] }}
                                                    {{ application['driver_surname'] }}'s Ride</h3>
                                            </a>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="container">
                                            <h4>Status</h4>
                                            <p>{{ application['status'].capitalize() }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                </div>
            {% endfor %}

        </div>



    </div>


{% endblock %}
